{"version":3,"sources":["../src/js/Trigger.js"],"names":["throwIfMissing","BoundingBox","Trigger","options","_show","bind","_hide","_handleEntry","_handleMovement","el","zoomPane","sourceAttribute","handleTouch","onShow","onHide","hoverDelay","touchDelay","hoverBoundingBox","touchBoundingBox","namespace","zoomFactor","boundingBoxContainer","settings","boundingBox","containerEl","enabled","_bindEvents","event","preventDefault","_isTouchEvent","isShowing","touches","addEventListener","_preventDefault","removeEventListener","e","_preventDefaultAllowTouchScroll","_lastMovement","type","entryTimeout","setTimeout","show","getAttribute","clientWidth","clientHeight","touchActivated","clearTimeout","hide","movementX","movementY","firstTouch","clientX","clientY","rect","getBoundingClientRect","offsetX","left","offsetY","top","percentageOffsetX","percentageOffsetY","setPosition"],"mappings":";;;;;;AAAA,OAAOA,cAAP,MAA2B,uBAA3B;AACA,OAAOC,WAAP,MAAwB,eAAxB;;IAEqBC,O;;;AACnB,qBAA0B;AAAA,QAAdC,OAAc,uEAAJ,EAAI;;AAAA;;AACxB,SAAKC,KAAL,GAAa,KAAKA,KAAL,CAAWC,IAAX,CAAgB,IAAhB,CAAb;AACA,SAAKC,KAAL,GAAa,KAAKA,KAAL,CAAWD,IAAX,CAAgB,IAAhB,CAAb;AACA,SAAKE,YAAL,GAAoB,KAAKA,YAAL,CAAkBF,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAKG,eAAL,GAAuB,KAAKA,eAAL,CAAqBH,IAArB,CAA0B,IAA1B,CAAvB;AAJwB,sBAoBpBF,OApBoB,CAOtBM,EAPsB;AAAA,QAOtBA,EAPsB,4BAOjBT,cAAc,EAPG;AAAA,4BAoBpBG,OApBoB,CAQtBO,QARsB;AAAA,QAQtBA,QARsB,kCAQXV,cAAc,EARH;AAAA,gCAoBpBG,OApBoB,CAStBQ,eATsB;AAAA,QAStBA,eATsB,sCASJX,cAAc,EATV;AAAA,+BAoBpBG,OApBoB,CAUtBS,WAVsB;AAAA,QAUtBA,WAVsB,qCAURZ,cAAc,EAVN;AAAA,0BAoBpBG,OApBoB,CAWtBU,MAXsB;AAAA,QAWtBA,MAXsB,gCAWb,IAXa;AAAA,0BAoBpBV,OApBoB,CAYtBW,MAZsB;AAAA,QAYtBA,MAZsB,gCAYb,IAZa;AAAA,8BAoBpBX,OApBoB,CAatBY,UAbsB;AAAA,QAatBA,UAbsB,oCAaT,CAbS;AAAA,8BAoBpBZ,OApBoB,CActBa,UAdsB;AAAA,QActBA,UAdsB,oCAcT,CAdS;AAAA,gCAoBpBb,OApBoB,CAetBc,gBAfsB;AAAA,QAetBA,gBAfsB,sCAeHjB,cAAc,EAfX;AAAA,gCAoBpBG,OApBoB,CAgBtBe,gBAhBsB;AAAA,QAgBtBA,gBAhBsB,sCAgBHlB,cAAc,EAhBX;AAAA,6BAoBpBG,OApBoB,CAiBtBgB,SAjBsB;AAAA,QAiBtBA,SAjBsB,mCAiBV,IAjBU;AAAA,8BAoBpBhB,OApBoB,CAkBtBiB,UAlBsB;AAAA,QAkBtBA,UAlBsB,oCAkBTpB,cAAc,EAlBL;AAAA,gCAoBpBG,OApBoB,CAmBtBkB,oBAnBsB;AAAA,QAmBtBA,oBAnBsB,sCAmBCrB,cAAc,EAnBf;AAsBxB,SAAKsB,QAAL,GAAgB;AACdb,MAAAA,EAAE,EAAFA,EADc;AAEdC,MAAAA,QAAQ,EAARA,QAFc;AAGdC,MAAAA,eAAe,EAAfA,eAHc;AAIdC,MAAAA,WAAW,EAAXA,WAJc;AAKdC,MAAAA,MAAM,EAANA,MALc;AAMdC,MAAAA,MAAM,EAANA,MANc;AAOdC,MAAAA,UAAU,EAAVA,UAPc;AAQdC,MAAAA,UAAU,EAAVA,UARc;AASdC,MAAAA,gBAAgB,EAAhBA,gBATc;AAUdC,MAAAA,gBAAgB,EAAhBA,gBAVc;AAWdC,MAAAA,SAAS,EAATA,SAXc;AAYdC,MAAAA,UAAU,EAAVA,UAZc;AAadC,MAAAA,oBAAoB,EAApBA;AAbc,KAAhB;;AAgBA,QAAI,KAAKC,QAAL,CAAcL,gBAAd,IAAkC,KAAKK,QAAL,CAAcJ,gBAApD,EAAsE;AACpE,WAAKK,WAAL,GAAmB,IAAItB,WAAJ,CAAgB;AACjCkB,QAAAA,SAAS,EAAE,KAAKG,QAAL,CAAcH,SADQ;AAEjCC,QAAAA,UAAU,EAAE,KAAKE,QAAL,CAAcF,UAFO;AAGjCI,QAAAA,WAAW,EAAE,KAAKF,QAAL,CAAcD;AAHM,OAAhB,CAAnB;AAKD;;AAED,SAAKI,OAAL,GAAe,IAAf;;AAEA,SAAKC,WAAL;AACD;;;;oCAMeC,K,EAAO;AACrBA,MAAAA,KAAK,CAACC,cAAN;AACD;;;oDAE+BD,K,EAAO;AACrC,UAAI,CAAC,KAAKL,QAAL,CAAcN,UAAf,IAA6B,CAAC,KAAKa,aAAL,CAAmBF,KAAnB,CAA9B,IAA2D,KAAKG,SAApE,EAA+E;AAC7EH,QAAAA,KAAK,CAACC,cAAN;AACD;AACF;;;kCAEaD,K,EAAO;AACnB,aAAO,CAAC,CAACA,KAAK,CAACI,OAAf;AACD;;;kCAEa;AACZ,WAAKT,QAAL,CAAcb,EAAd,CAAiBuB,gBAAjB,CAAkC,YAAlC,EAAgD,KAAKzB,YAArD,EAAmE,KAAnE;AACA,WAAKe,QAAL,CAAcb,EAAd,CAAiBuB,gBAAjB,CAAkC,YAAlC,EAAgD,KAAK1B,KAArD,EAA4D,KAA5D;AACA,WAAKgB,QAAL,CAAcb,EAAd,CAAiBuB,gBAAjB,CAAkC,WAAlC,EAA+C,KAAKxB,eAApD,EAAqE,KAArE;;AAEA,UAAI,KAAKc,QAAL,CAAcV,WAAlB,EAA+B;AAC7B,aAAKU,QAAL,CAAcb,EAAd,CAAiBuB,gBAAjB,CAAkC,YAAlC,EAAgD,KAAKzB,YAArD,EAAmE,KAAnE;AACA,aAAKe,QAAL,CAAcb,EAAd,CAAiBuB,gBAAjB,CAAkC,UAAlC,EAA8C,KAAK1B,KAAnD,EAA0D,KAA1D;AACA,aAAKgB,QAAL,CAAcb,EAAd,CAAiBuB,gBAAjB,CAAkC,WAAlC,EAA+C,KAAKxB,eAApD,EAAqE,KAArE;AACD,OAJD,MAIO;AACL,aAAKc,QAAL,CAAcb,EAAd,CAAiBuB,gBAAjB,CAAkC,YAAlC,EAAgD,KAAKC,eAArD,EAAsE,KAAtE;AACA,aAAKX,QAAL,CAAcb,EAAd,CAAiBuB,gBAAjB,CAAkC,UAAlC,EAA8C,KAAKC,eAAnD,EAAoE,KAApE;AACA,aAAKX,QAAL,CAAcb,EAAd,CAAiBuB,gBAAjB,CAAkC,WAAlC,EAA+C,KAAKC,eAApD,EAAqE,KAArE;AACD;AACF;;;oCAEe;AACd,WAAKX,QAAL,CAAcb,EAAd,CAAiByB,mBAAjB,CAAqC,YAArC,EAAmD,KAAK3B,YAAxD,EAAsE,KAAtE;AACA,WAAKe,QAAL,CAAcb,EAAd,CAAiByB,mBAAjB,CAAqC,YAArC,EAAmD,KAAK5B,KAAxD,EAA+D,KAA/D;AACA,WAAKgB,QAAL,CAAcb,EAAd,CAAiByB,mBAAjB,CAAqC,WAArC,EAAkD,KAAK1B,eAAvD,EAAwE,KAAxE;;AAEA,UAAI,KAAKc,QAAL,CAAcV,WAAlB,EAA+B;AAC7B,aAAKU,QAAL,CAAcb,EAAd,CAAiByB,mBAAjB,CAAqC,YAArC,EAAmD,KAAK3B,YAAxD,EAAsE,KAAtE;AACA,aAAKe,QAAL,CAAcb,EAAd,CAAiByB,mBAAjB,CAAqC,UAArC,EAAiD,KAAK5B,KAAtD,EAA6D,KAA7D;AACA,aAAKgB,QAAL,CAAcb,EAAd,CAAiByB,mBAAjB,CAAqC,WAArC,EAAkD,KAAK1B,eAAvD,EAAwE,KAAxE;AACD,OAJD,MAIO;AACL,aAAKc,QAAL,CAAcb,EAAd,CAAiByB,mBAAjB,CAAqC,YAArC,EAAmD,KAAKD,eAAxD,EAAyE,KAAzE;AACA,aAAKX,QAAL,CAAcb,EAAd,CAAiByB,mBAAjB,CAAqC,UAArC,EAAiD,KAAKD,eAAtD,EAAuE,KAAvE;AACA,aAAKX,QAAL,CAAcb,EAAd,CAAiByB,mBAAjB,CAAqC,WAArC,EAAkD,KAAKD,eAAvD,EAAwE,KAAxE;AACD;AACF;;;iCAEYE,C,EAAG;AACd,WAAKC,+BAAL,CAAqCD,CAArC;;AACA,WAAKE,aAAL,GAAqBF,CAArB;;AAEA,UAAIA,CAAC,CAACG,IAAF,IAAU,YAAV,IAA0B,KAAKhB,QAAL,CAAcP,UAA5C,EAAwD;AACtD,aAAKwB,YAAL,GAAoBC,UAAU,CAAC,KAAKpC,KAAN,EAAa,KAAKkB,QAAL,CAAcP,UAA3B,CAA9B;AACD,OAFD,MAEO,IAAI,KAAKO,QAAL,CAAcN,UAAlB,EAA8B;AACnC,aAAKuB,YAAL,GAAoBC,UAAU,CAAC,KAAKpC,KAAN,EAAa,KAAKkB,QAAL,CAAcN,UAA3B,CAA9B;AACD,OAFM,MAEA;AACL,aAAKZ,KAAL;AACD;AACF;;;4BAEO;AACN,UAAI,CAAC,KAAKqB,OAAV,EAAmB;AACjB;AACD;;AAED,UAAMZ,MAAM,GAAG,KAAKS,QAAL,CAAcT,MAA7B;;AACA,UAAIA,MAAM,IAAI,OAAOA,MAAP,KAAkB,UAAhC,EAA4C;AAC1CA,QAAAA,MAAM;AACP;;AAED,WAAKS,QAAL,CAAcZ,QAAd,CAAuB+B,IAAvB,CACE,KAAKnB,QAAL,CAAcb,EAAd,CAAiBiC,YAAjB,CAA8B,KAAKpB,QAAL,CAAcX,eAA5C,CADF,EAEE,KAAKW,QAAL,CAAcb,EAAd,CAAiBkC,WAFnB,EAGE,KAAKrB,QAAL,CAAcb,EAAd,CAAiBmC,YAHnB;;AAMA,UAAI,KAAKP,aAAT,EAAwB;AACtB,YAAMQ,cAAc,GAAG,KAAKR,aAAL,CAAmBN,OAA1C;;AACA,YAAKc,cAAc,IAAI,KAAKvB,QAAL,CAAcJ,gBAAjC,IAAuD,CAAC2B,cAAD,IAAmB,KAAKvB,QAAL,CAAcL,gBAA5F,EAA+G;AAC7G,eAAKM,WAAL,CAAiBkB,IAAjB,CAAsB,KAAKnB,QAAL,CAAcZ,QAAd,CAAuBD,EAAvB,CAA0BkC,WAAhD,EAA6D,KAAKrB,QAAL,CAAcZ,QAAd,CAAuBD,EAAvB,CAA0BmC,YAAvF;AACD;AACF;;AAED,WAAKpC,eAAL;AACD;;;0BAEK2B,C,EAAG;AACP,UAAIA,CAAJ,EAAO;AACL,aAAKC,+BAAL,CAAqCD,CAArC;AACD;;AAED,WAAKE,aAAL,GAAqB,IAArB;;AAEA,UAAI,KAAKE,YAAT,EAAuB;AACrBO,QAAAA,YAAY,CAAC,KAAKP,YAAN,CAAZ;AACD;;AAED,UAAI,KAAKhB,WAAT,EAAsB;AACpB,aAAKA,WAAL,CAAiBwB,IAAjB;AACD;;AAED,UAAMjC,MAAM,GAAG,KAAKQ,QAAL,CAAcR,MAA7B;;AACA,UAAIA,MAAM,IAAI,OAAOA,MAAP,KAAkB,UAAhC,EAA4C;AAC1CA,QAAAA,MAAM;AACP;;AAED,WAAKQ,QAAL,CAAcZ,QAAd,CAAuBqC,IAAvB;AACD;;;oCAEeZ,C,EAAG;AACjB,UAAIA,CAAJ,EAAO;AACL,aAAKC,+BAAL,CAAqCD,CAArC;;AACA,aAAKE,aAAL,GAAqBF,CAArB;AACD,OAHD,MAGO,IAAI,KAAKE,aAAT,EAAwB;AAC7BF,QAAAA,CAAC,GAAG,KAAKE,aAAT;AACD,OAFM,MAEA;AACL;AACD;;AAED,UAAIW,SAAJ;AACA,UAAIC,SAAJ;;AAEA,UAAId,CAAC,CAACJ,OAAN,EAAe;AACb,YAAMmB,UAAU,GAAGf,CAAC,CAACJ,OAAF,CAAU,CAAV,CAAnB;AACAiB,QAAAA,SAAS,GAAGE,UAAU,CAACC,OAAvB;AACAF,QAAAA,SAAS,GAAGC,UAAU,CAACE,OAAvB;AACD,OAJD,MAIO;AACLJ,QAAAA,SAAS,GAAGb,CAAC,CAACgB,OAAd;AACAF,QAAAA,SAAS,GAAGd,CAAC,CAACiB,OAAd;AACD;;AAED,UAAM3C,EAAE,GAAG,KAAKa,QAAL,CAAcb,EAAzB;AACA,UAAM4C,IAAI,GAAG5C,EAAE,CAAC6C,qBAAH,EAAb;AACA,UAAMC,OAAO,GAAGP,SAAS,GAAGK,IAAI,CAACG,IAAjC;AACA,UAAMC,OAAO,GAAGR,SAAS,GAAGI,IAAI,CAACK,GAAjC;AAEA,UAAMC,iBAAiB,GAAGJ,OAAO,GAAG,KAAKjC,QAAL,CAAcb,EAAd,CAAiBkC,WAArD;AACA,UAAMiB,iBAAiB,GAAGH,OAAO,GAAG,KAAKnC,QAAL,CAAcb,EAAd,CAAiBmC,YAArD;;AAEA,UAAI,KAAKrB,WAAT,EAAsB;AACpB,aAAKA,WAAL,CAAiBsC,WAAjB,CAA6BF,iBAA7B,EAAgDC,iBAAhD,EAAmEP,IAAnE;AACD;;AAED,WAAK/B,QAAL,CAAcZ,QAAd,CAAuBmD,WAAvB,CAAmCF,iBAAnC,EAAsDC,iBAAtD,EAAyEP,IAAzE;AACD;;;wBAnJe;AACd,aAAO,KAAK/B,QAAL,CAAcZ,QAAd,CAAuBoB,SAA9B;AACD;;;;;;SAtDkB5B,O","sourcesContent":["import throwIfMissing from \"./util/throwIfMissing\";\nimport BoundingBox from \"./BoundingBox\";\n\nexport default class Trigger {\n  constructor(options = {}) {\n    this._show = this._show.bind(this);\n    this._hide = this._hide.bind(this);\n    this._handleEntry = this._handleEntry.bind(this);\n    this._handleMovement = this._handleMovement.bind(this);\n\n    const {\n      el = throwIfMissing(),\n      zoomPane = throwIfMissing(),\n      sourceAttribute = throwIfMissing(),\n      handleTouch = throwIfMissing(),\n      onShow = null,\n      onHide = null,\n      hoverDelay = 0,\n      touchDelay = 0,\n      hoverBoundingBox = throwIfMissing(),\n      touchBoundingBox = throwIfMissing(),\n      namespace = null,\n      zoomFactor = throwIfMissing(),\n      boundingBoxContainer = throwIfMissing()\n    } = options;\n\n    this.settings = {\n      el,\n      zoomPane,\n      sourceAttribute,\n      handleTouch,\n      onShow,\n      onHide,\n      hoverDelay,\n      touchDelay,\n      hoverBoundingBox,\n      touchBoundingBox,\n      namespace,\n      zoomFactor,\n      boundingBoxContainer\n    };\n\n    if (this.settings.hoverBoundingBox || this.settings.touchBoundingBox) {\n      this.boundingBox = new BoundingBox({\n        namespace: this.settings.namespace,\n        zoomFactor: this.settings.zoomFactor,\n        containerEl: this.settings.boundingBoxContainer\n      });\n    }\n\n    this.enabled = true;\n\n    this._bindEvents();\n  }\n\n  get isShowing() {\n    return this.settings.zoomPane.isShowing;\n  }\n\n  _preventDefault(event) {\n    event.preventDefault();\n  }\n\n  _preventDefaultAllowTouchScroll(event) {\n    if (!this.settings.touchDelay || !this._isTouchEvent(event) || this.isShowing) {\n      event.preventDefault();\n    }\n  }\n\n  _isTouchEvent(event) {\n    return !!event.touches;\n  }\n\n  _bindEvents() {\n    this.settings.el.addEventListener(\"mouseenter\", this._handleEntry, false);\n    this.settings.el.addEventListener(\"mouseleave\", this._hide, false);\n    this.settings.el.addEventListener(\"mousemove\", this._handleMovement, false);\n\n    if (this.settings.handleTouch) {\n      this.settings.el.addEventListener(\"touchstart\", this._handleEntry, false);\n      this.settings.el.addEventListener(\"touchend\", this._hide, false);\n      this.settings.el.addEventListener(\"touchmove\", this._handleMovement, false);\n    } else {\n      this.settings.el.addEventListener(\"touchstart\", this._preventDefault, false);\n      this.settings.el.addEventListener(\"touchend\", this._preventDefault, false);\n      this.settings.el.addEventListener(\"touchmove\", this._preventDefault, false);\n    }\n  }\n\n  _unbindEvents() {\n    this.settings.el.removeEventListener(\"mouseenter\", this._handleEntry, false);\n    this.settings.el.removeEventListener(\"mouseleave\", this._hide, false);\n    this.settings.el.removeEventListener(\"mousemove\", this._handleMovement, false);\n\n    if (this.settings.handleTouch) {\n      this.settings.el.removeEventListener(\"touchstart\", this._handleEntry, false);\n      this.settings.el.removeEventListener(\"touchend\", this._hide, false);\n      this.settings.el.removeEventListener(\"touchmove\", this._handleMovement, false);\n    } else {\n      this.settings.el.removeEventListener(\"touchstart\", this._preventDefault, false);\n      this.settings.el.removeEventListener(\"touchend\", this._preventDefault, false);\n      this.settings.el.removeEventListener(\"touchmove\", this._preventDefault, false);\n    }\n  }\n\n  _handleEntry(e) {\n    this._preventDefaultAllowTouchScroll(e);\n    this._lastMovement = e;\n\n    if (e.type == \"mouseenter\" && this.settings.hoverDelay) {\n      this.entryTimeout = setTimeout(this._show, this.settings.hoverDelay);\n    } else if (this.settings.touchDelay) {\n      this.entryTimeout = setTimeout(this._show, this.settings.touchDelay);\n    } else {\n      this._show();\n    }\n  }\n\n  _show() {\n    if (!this.enabled) {\n      return;\n    }\n\n    const onShow = this.settings.onShow;\n    if (onShow && typeof onShow === \"function\") {\n      onShow();\n    }\n\n    this.settings.zoomPane.show(\n      this.settings.el.getAttribute(this.settings.sourceAttribute),\n      this.settings.el.clientWidth,\n      this.settings.el.clientHeight\n    );\n\n    if (this._lastMovement) {\n      const touchActivated = this._lastMovement.touches;\n      if ((touchActivated && this.settings.touchBoundingBox) || (!touchActivated && this.settings.hoverBoundingBox)) {\n        this.boundingBox.show(this.settings.zoomPane.el.clientWidth, this.settings.zoomPane.el.clientHeight);\n      }\n    }\n\n    this._handleMovement();\n  }\n\n  _hide(e) {\n    if (e) {\n      this._preventDefaultAllowTouchScroll(e);\n    }\n\n    this._lastMovement = null;\n\n    if (this.entryTimeout) {\n      clearTimeout(this.entryTimeout);\n    }\n\n    if (this.boundingBox) {\n      this.boundingBox.hide();\n    }\n\n    const onHide = this.settings.onHide;\n    if (onHide && typeof onHide === \"function\") {\n      onHide();\n    }\n\n    this.settings.zoomPane.hide();\n  }\n\n  _handleMovement(e) {\n    if (e) {\n      this._preventDefaultAllowTouchScroll(e);\n      this._lastMovement = e;\n    } else if (this._lastMovement) {\n      e = this._lastMovement;\n    } else {\n      return;\n    }\n\n    let movementX;\n    let movementY;\n\n    if (e.touches) {\n      const firstTouch = e.touches[0];\n      movementX = firstTouch.clientX;\n      movementY = firstTouch.clientY;\n    } else {\n      movementX = e.clientX;\n      movementY = e.clientY;\n    }\n\n    const el = this.settings.el;\n    const rect = el.getBoundingClientRect();\n    const offsetX = movementX - rect.left;\n    const offsetY = movementY - rect.top;\n\n    const percentageOffsetX = offsetX / this.settings.el.clientWidth;\n    const percentageOffsetY = offsetY / this.settings.el.clientHeight;\n\n    if (this.boundingBox) {\n      this.boundingBox.setPosition(percentageOffsetX, percentageOffsetY, rect);\n    }\n\n    this.settings.zoomPane.setPosition(percentageOffsetX, percentageOffsetY, rect);\n  }\n}\n"],"file":"Trigger.js"}